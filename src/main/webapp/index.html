<!DOCTYPE html>
<html lang="en">

  <!-- comment -->

<head>
    <title>Kiss Application</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="kiss/utils.css">


    <style>

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            padding: 3px 3px 50px 3px;
            box-sizing: border-box;
        }

        label {
            margin-top: 3px;
        }

        .center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
        }

    </style>

    <script>

        function startup() {

            // cache control
            var softwareVersion = "1";   // version of the entire system
            var controlCache = true;     // normally true but use false during debugging

            var afterLoad = function () {
                utils.softwareVersion = softwareVersion;
                utils.controlCache = controlCache;
                loadScript("index.js", function () {
                    // do nothing
                });
            };

            var numLoaded = 0;

            var loadScript = function (script, fun) {
                if (fun)
                    $.getScript(script + (controlCache ? '?ver=' + softwareVersion : ''), fun);
                else {
                    numLoaded++;
                    $.getScript(script + (controlCache ? '?ver=' + softwareVersion : ''), function () {
                        if (!--numLoaded)
                            afterLoad();
                    });
                }
            };

            var loadUtils = function () {
                loadScript("kiss/utils.js");
                loadScript("kiss/dateutils.js");
                loadScript("kiss/Server.js");
            };


            $.ajaxSetup({ cache: controlCache });  // utilize browser cache to the fullest when version hasn't changed

            var getURLParameter = function (sParam) {
                var sPageURL = window.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                for (var i = 0; i < sURLVariables.length; i++)  {
                    var sParameterName = sURLVariables[i].split('=');
                    if (sParameterName[0] === sParam)
                        return sParameterName[1];
                }
            };

            if (controlCache) {
                var now = getURLParameter("now");
                if (now) {
                    var diff = Math.abs(((new Date()).getTime() - Number(now)) / 1000);
                    if (diff > 30)
                        window.location.href = 'index.html?now=' + (new Date()).getTime();
                    else {
                        loadUtils();
                    }
                } else
                    window.location.href = 'index.html?now=' + (new Date()).getTime();
            } else
                loadUtils();
        }

    </script>

</head>

<body onload="startup()">

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous"></script>


</body>

</html>
